events {
    worker_connections 1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    # Debug logging
    error_log /var/log/nginx/error.log debug;
    access_log /var/log/nginx/access.log combined;

    server {
        listen 80;
        server_name quic.dryagindenisrus.local;
        return 301 https://$host$request_uri;
    }

    server {
        # HTTP/3 (QUIC) first
        listen 443 quic reuseport;
        # HTTP/2 as fallback
        listen 443 ssl http2;
        
        server_name quic.dryagindenisrus.local;
        
        # Disable HTTP/2 to force HTTP/3
        http2 off;
        quic_retry on;
        
        ssl_certificate     /usr/share/nginx/ssl/server.crt;
        ssl_certificate_key /usr/share/nginx/ssl/server.key;
        ssl_protocols TLSv1.3;
        ssl_early_data on;

        # Force HTTP/3
        add_header Alt-Svc 'h3=":443"; ma=86400' always;
        add_header QUIC-Status $http3;

        root /usr/share/nginx/html;
        index index.html;

        location /static/ {
            alias /usr/share/nginx/html/static/;
            expires 1y;
            add_header Cache-Control "public";
            access_log off;
        }

        location / {
            try_files $uri $uri/ /index.html;
        }
    }
}